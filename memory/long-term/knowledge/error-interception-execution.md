# 错误消息拦截执行措施

**规则**: SOUL.md 规则11 - Error Message Translation
**目标**: 确保所有技术错误都转换成人话，不直接转发给用户

---

## 🛡️ 执行措施清单

### 措施1: 预检查清单（每次发送前强制执行）

```
发送消息前必须检查：
□ 是否包含系统错误代码？（如 request id、error code）
□ 是否是技术术语？（如限流、timeout、exception）
□ 是否是英文错误？
□ 是否包含不明所以的字符串？

如果以上任何一项为YES → 必须转换成人话后再发送
```

### 措施2: 错误类型识别库

**必须拦截的关键字模式：**
```
- "request id:" → 系统调用失败
- "限流" / "rate limit" → 访问太频繁
- "timeout" / "超时" → 网络/操作超时
- "exception" / "error:" → 程序异常
- "failed" / "failure" → 操作失败
- "403" / "404" / "500" → HTTP错误码
- "cannot" / "unable to" → 无法执行
```

**识别到以上模式 → 自动触发转换流程**

### 措施3: 转换流程（强制步骤）

```
检测到技术错误
   ↓
1. 暂停发送（不要直接转发）
   ↓
2. 分析：什么任务失败了？
   ↓
3. 翻译：用一句话解释问题
   ↓
4. 补充：影响范围 + 解决方案
   ↓
5. 生成人话版本
   ↓
6. 发送人话版本（替换原始错误）
```

### 措施4: 模板化输出（强制格式）

**人话版本必须包含：**
```
⚠️ [一句话说明问题]

失败任务: [具体任务]
实际原因: [人话解释]
影响: [对用户的影响]
建议: [下一步怎么做]
```

**示例：**
```
❌ 原始：因触发限流调用内置集成失败, request id: xxx

✅ 人话：
⚠️ 文件修改暂时失败

失败任务: 调整日报发送时间
实际原因: 系统操作太频繁，触发了保护机制
影响: 日报时间还是原来的23:59，需要稍后重试
建议: 我稍后自动重试，或您确认是否继续修改
```

### 措施5: 事后自检（每次对话结束后）

```
对话结束后检查：
□ 是否发送过原始错误消息？
□ 如果有，立即补发人话解释
□ 记录到改进日志
```

### 措施6: 记忆系统记录

**写入memory/daily/的每日记录：**
```
今日错误拦截执行情况:
- 拦截次数: X
- 成功转换: X
- 遗漏次数: X（已补发解释）
- 改进措施: [具体改进]
```

---

## 📋 执行检查表（贴在显眼位置）

**每次发送消息前，默念：**
1. 这是人话吗？
2. 老板看得懂吗？
3. 包含错误代码吗？
4. 如果需要处理，说明白了吗？

**如果答案不满意 → 重写 → 再检查**

---

## 🎯 关键指标

**衡量标准：**
- 技术错误直接转发率 = 0%
- 人话解释覆盖率 = 100%
- 用户追问"这是什么意思"次数 = 0

**如果失败：**
- 立即道歉
- 立即补发正确解释
- 记录到改进日志
- 调整执行措施

---

## 🔧 技术实现

**代码层面检查：**
```python
def send_message(text):
    # 1. 检查是否是错误消息
    if contains_error_patterns(text):
        # 2. 转换成人话
        human_text = translate_error(text)
        # 3. 发送人话版本
        return human_text
    # 4. 正常发送
    return text
```

**触发器设置：**
- 监控所有输出
- 匹配错误模式自动拦截
- 强制进入转换流程

---

## 📊 审查机制

**每日自检（日报中体现）：**
```
今日错误拦截执行检查:
✅ 所有技术错误已转换人话
✅ 无原始错误码直接发送
✅ 用户无追问"这是什么意思"
```

**如果发现问题：**
- 在日报中承认
- 说明改进措施
- 老板监督执行

---

**生效日期**: 2026-03-01  
**执行人**: 扣子虾  
**监督方式**: 日报自检 + 老板反馈
